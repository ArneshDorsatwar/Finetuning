[
  {
    "conversations": [
      {
        "from": "human",
        "value": "How do I configure port security on a Cisco switch to limit MAC addresses per port?"
      },
      {
        "from": "gpt",
        "value": "To configure port security on a Cisco switch, follow these steps:\n\n1. Enter interface configuration mode:\n```\nSwitch(config)# interface GigabitEthernet0/1\n```\n\n2. Set the interface to access mode:\n```\nSwitch(config-if)# switchport mode access\n```\n\n3. Enable port security:\n```\nSwitch(config-if)# switchport port-security\n```\n\n4. Set maximum allowed MAC addresses (default is 1):\n```\nSwitch(config-if)# switchport port-security maximum 2\n```\n\n5. Configure violation action (shutdown, restrict, or protect):\n```\nSwitch(config-if)# switchport port-security violation shutdown\n```\n\n6. Optionally, use sticky MAC learning:\n```\nSwitch(config-if)# switchport port-security mac-address sticky\n```\n\n7. Verify configuration:\n```\nSwitch# show port-security interface GigabitEthernet0/1\n```\n\n**Violation Actions Explained:**\n- **shutdown**: Disables the port and sends SNMP trap (default, most secure)\n- **restrict**: Drops violating packets, increments counter, sends SNMP trap\n- **protect**: Silently drops violating packets (no logging)\n\n**Best Practices:**\n- Use 'sticky' to automatically learn and save MAC addresses\n- Always monitor syslog for violation alerts\n- Document authorized MAC addresses in your network inventory\n- Use 'shutdown' mode for critical access ports\n- Consider combining with 802.1X for stronger authentication\n\n**Security Warning:** Port security alone is not foolproof as MAC addresses can be spoofed. It should be part of a defense-in-depth strategy, not the only security measure."
      }
    ]
  },
  {
    "conversations": [
      {
        "from": "human",
        "value": "Explain the difference between AWS Security Groups and Network ACLs."
      },
      {
        "from": "gpt",
        "value": "AWS Security Groups and Network ACLs (NACLs) are both firewall mechanisms, but they operate differently:\n\n**Security Groups:**\n- **Stateful**: Return traffic automatically allowed\n- **Instance-level**: Attached to ENIs (Elastic Network Interfaces)\n- **Allow rules only**: Can't explicitly deny traffic\n- **Evaluated rules**: All rules evaluated before allowing traffic\n- **Default behavior**: Denies all inbound, allows all outbound\n\n**Network ACLs:**\n- **Stateless**: Must explicitly allow both directions\n- **Subnet-level**: Applied to entire subnets\n- **Allow AND deny rules**: Can explicitly block traffic\n- **Rule order matters**: Rules processed in numerical order\n- **Default behavior**: Allows all traffic (default NACL)\n\n**Example Scenario:**\n\n*Security Group (attached to EC2 instance):*\n```bash\n# Allow inbound SSH from specific IP\naws ec2 authorize-security-group-ingress \\\n  --group-id sg-0123456789abcdef \\\n  --protocol tcp --port 22 \\\n  --cidr 203.0.113.0/24\n\n# Return traffic automatically allowed (stateful)\n```\n\n*Network ACL (applied to subnet):*\n```bash\n# Allow inbound SSH\naws ec2 create-network-acl-entry \\\n  --network-acl-id acl-0123456789abcdef \\\n  --rule-number 100 --protocol tcp \\\n  --port-range From=22,To=22 \\\n  --cidr-block 203.0.113.0/24 \\\n  --egress false --rule-action allow\n\n# Must also allow outbound ephemeral ports for return traffic\naws ec2 create-network-acl-entry \\\n  --network-acl-id acl-0123456789abcdef \\\n  --rule-number 100 --protocol tcp \\\n  --port-range From=1024,To=65535 \\\n  --cidr-block 203.0.113.0/24 \\\n  --egress true --rule-action allow\n```\n\n**When to Use Each:**\n\n*Use Security Groups for:*\n- Controlling access to specific instances\n- Allowing traffic between security groups\n- Most common use cases (preferred)\n- Simpler management (stateful)\n\n*Use NACLs for:*\n- Subnet-level protection (additional layer)\n- Explicitly blocking specific IPs (deny rules)\n- Compliance requirements for subnet isolation\n- Defense in depth strategy\n\n**Best Practice:** Use Security Groups as primary control, add NACLs as secondary layer for sensitive subnets. This defense-in-depth approach provides better security.\n\n**Common Mistake:** Forgetting to allow ephemeral ports (1024-65535) in NACL outbound rules for return traffic, which breaks stateless connections."
      }
    ]
  },
  {
    "conversations": [
      {
        "from": "human",
        "value": "I'm seeing dropped packets on my AWS EC2 instances. How do I troubleshoot this?"
      },
      {
        "from": "gpt",
        "value": "Let's systematically troubleshoot the dropped packets. Start with these checks:\n\n**1. Check Security Group Rules:**\n```bash\naws ec2 describe-security-groups --group-ids sg-xxxxxxxxx\n```\nVerify both inbound and outbound rules allow your traffic.\n\n**2. Check Network ACLs:**\n```bash\naws ec2 describe-network-acls --filters \"Name=association.subnet-id,Values=subnet-xxxxxxxx\"\n```\nRemember NACLs are stateless - ensure both directions are allowed.\n\n**3. Enable VPC Flow Logs:**\nIf not already active, enable Flow Logs to see exactly what's being dropped:\n```bash\naws ec2 create-flow-logs \\\n  --resource-type VPC \\\n  --resource-ids vpc-xxxxxxxx \\\n  --traffic-type REJECT \\\n  --log-destination-type cloud-watch-logs \\\n  --log-group-name /aws/vpc/flowlogs\n```\n\n**4. Query Flow Logs:**\n```bash\n# View recent rejected traffic\naws logs filter-log-events \\\n  --log-group-name /aws/vpc/flowlogs \\\n  --filter-pattern \"[version, account, eni, source, destination, srcport, destport, protocol, packets, bytes, start, end, action=REJECT, status]\"\n```\n\nCan you tell me:\n- What type of traffic is being dropped (HTTP, SSH, database, custom ports)?\n- Are the instances in public or private subnets?\n- Have Security Groups or NACLs been modified recently?\n- Is this affecting all instances or specific ones?"
      },
      {
        "from": "human",
        "value": "It's HTTP traffic on port 80. The instances are in a public subnet. Security groups were updated yesterday."
      },
      {
        "from": "gpt",
        "value": "The recent Security Group change is likely the culprit. Let's verify and fix:\n\n**Step 1: Check current Security Group rules:**\n```bash\naws ec2 describe-security-groups \\\n  --group-ids sg-xxxxxxxxx \\\n  --query 'SecurityGroups[0].IpPermissions'\n```\n\nLook for a rule allowing TCP port 80. You should see:\n```json\n{\n  \"IpProtocol\": \"tcp\",\n  \"FromPort\": 80,\n  \"ToPort\": 80,\n  \"IpRanges\": [{\"CidrIp\": \"0.0.0.0/0\"}]\n}\n```\n\n**Step 2: If missing, add HTTP rule:**\n```bash\naws ec2 authorize-security-group-ingress \\\n  --group-id sg-xxxxxxxxx \\\n  --protocol tcp \\\n  --port 80 \\\n  --cidr 0.0.0.0/0\n```\n\n**Step 3: Verify with VPC Flow Logs:**\nAfter adding the rule, check if packets are now accepted:\n```bash\naws logs filter-log-events \\\n  --log-group-name /aws/vpc/flowlogs \\\n  --start-time $(date -d '5 minutes ago' +%s)000 \\\n  --filter-pattern \"[version, account, eni, source, destination, srcport, destport=80, protocol=6, packets, bytes, start, end, action, status]\"\n```\n\nLook for entries changing from REJECT to ACCEPT.\n\n**Step 4: Check Security Group change history:**\n```bash\naws ec2 describe-security-group-rules \\\n  --filters \"Name=group-id,Values=sg-xxxxxxxxx\"\n```\n\n**Additional Checks if Still Dropping:**\n\n1. **OS-level firewall (inside the instance):**\n```bash\nssh ec2-user@<instance-ip>\nsudo iptables -L -n  # Check for blocking rules\n```\n\n2. **Application listening on correct interface:**\n```bash\nsudo netstat -tlnp | grep :80\n# Should show 0.0.0.0:80 (not 127.0.0.1:80)\n```\n\n3. **Route table configuration:**\n```bash\naws ec2 describe-route-tables \\\n  --filters \"Name=association.subnet-id,Values=subnet-xxxxxxxx\"\n# Verify route to Internet Gateway exists: 0.0.0.0/0 â†’ igw-xxxxxxxx\n```\n\n4. **Instance health checks (if behind load balancer):**\n```bash\naws elbv2 describe-target-health \\\n  --target-group-arn <target-group-arn>\n```\n\n**Pro Tip:** Set up CloudWatch alarms for Security Group changes:\n```bash\naws cloudtrail lookup-events \\\n  --lookup-attributes AttributeKey=EventName,AttributeValue=AuthorizeSecurityGroupIngress \\\n  --max-items 10\n```\n\nThis helps track who made changes and when, making troubleshooting faster.\n\n**Prevention:** Use Infrastructure as Code (Terraform/CloudFormation) to manage Security Groups. This prevents accidental changes and provides version control."
      }
    ]
  }
]
